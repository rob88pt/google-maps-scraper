# Session Handoff: Google Maps Scraper - Review Image Investigation

Read this file to continue where the previous session left off.

## Project Location
`D:\Websites\GMaps_scraper_gosom`

## Context Files to Read First
1. `docs/active_context.md` - current state overview (Review Images issue)
2. `source/gmaps/entry.go` - location of the review parser (`parseReviews` function)
3. `leads-command-center/src/lib/docker.ts` - frontend interfaces for results

## What Was Done This Session
- **Fixed Review Display**: The Leads Command Center now correctly displays extra reviews. The issue was a casing mismatch between Go's default capitalized JSON and the TS interfaces.
- **Investigation: Review Images**: The user reported that review images are missing.
    - Checked raw job data (e.g., `leads-command-center/.jobs/8e247652-91fa-4c76-bd92-06386200b4c7/results.json`).
    - **Discovery**: The `images` array in reviews contains links like `www.google.com/local/imagery/report/...` instead of actual images (`lh3.googleusercontent.com`).
    - **Root Cause**: The RPC parser in `source/gmaps/entry.go` (Line 461, `parseReviews`) is likely using outdated array indices for the `images` data in the Google Maps RPC response.

## What's Left to Do
- [ ] **Fix Review Image Extraction**:
    - Update `parseReviews` in `source/gmaps/entry.go` to correctly find the `lh3` URLs in the RPC response.
    - Use browser devtools to inspect the RPC response (`search` or `place` reviews) to find the correct indices.
- [ ] **Performance Safeguards** (Defered by user but still needed):
    - Add context timeout (e.g., 2m) to `BrowserActions` in `place.go`.
    - Add page limit to `fetch` in `reviews.go` to prevent infinite loops on massive review sets.
- [ ] **Feature: Map Coordinate Picker**: Implement a map-based UI for selecting search coordinates.

## Gotchas / Watch Out For
- Port `9222` is used for remote debugging. Ensure Chrome is launched with the debug flag if using browser automation.
- The scraper forked logic is in `source/`. Always rebuild/re-run jobs to test parser changes.

## How to Verify Current State
1. Run a job with extra reviews (e.g., 10-20).
2. Check `results.json` in the job folder to see if `user_reviews[].images` contains `lh3.googleusercontent.com` links.
3. Open the Leads Command Center UI and check if photos appear in the lead detail panel.

## Suggested First Action
Research current Google Maps RPC structure for reviews to identify the correct indices for photo URLs, then modify `source/gmaps/entry.go` -> `parseReviews`.
