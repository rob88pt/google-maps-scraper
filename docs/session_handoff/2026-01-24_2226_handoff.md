# Session Handoff: Google Maps Scraper Monorepo

Read this file to continue where the previous session left off.

## Project Location
`d:\Websites\GMaps_scraper_gosom`

## Context Files to Read First
1. `docs/active_context.md` - Helper context & state
2. `source/FORK_CHANGELOG.md` - Specific changes to the scraper source
3. `leads-command-center/src/lib/supabase/types.ts` - Data types

## What Was Done This Session
- **Fixed Scraper Panic**: Initialized `patterns` map in `gmaps/reviews.go` preventing crashes during place ID extraction.
- **Improved Data Extraction**:
  - Filtered out invalid "Report this photo" images.
  - Improved regex to capture decimal ratings (5.0).
- **Fixed Frontend Display**:
  - Identified mismatch between Go's PascalCase JSON keys and Frontend's snake_case expectation.
  - Updated Frontend (`types.ts`, `lead-detail-panel.tsx`) to accept PascalCase keys (`Name`, `Rating`, etc.).
  - Added JSON tags to Go struct as a backup/future-proofing measure, though Frontend was adapted first.
- **Docker Image**: Rebuilt `google-maps-scraper:custom` with these fixes.

## What's Left to Do
- [ ] **Performance Safeguards**: Implement timeout in `place.go` to prevent infinite hanging on slow pages.
- [ ] **Page Limits**: Add logic to `reviews.go` to stop fetching extra reviews after N pages (current implementation relies on scroll count but could be robustified).
- [ ] **Map Coordinate Picker**: Feature to help users pick coordinates visually.

## Key Decisions Made
- **Frontend Adaptation**: Adapted the frontend to strict PascalCase keys from the scraper rather than modifying the scraper source heavily (though some tags were added).
- **Fork Tracking**: Created `source/FORK_CHANGELOG.md` to strictly track deviations from upstream `gosom/google-maps-scraper`.

## How to Verify Current State
1. Run `npm run dev` in `leads-command-center`.
2. Create a job with "Extra Reviews" enabled.
3. Verify job completes without "status: failed".
4. Resulting JSON should show reviews in the "Lead Details" panel (click a row in the table).
