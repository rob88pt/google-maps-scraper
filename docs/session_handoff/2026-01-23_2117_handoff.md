# Session Handoff: Clean Environment & Ready for Fresh Sync Test

Read this file to continue where the previous session left off.

## Project Location
`D:\Websites\GMaps_scraper_gosom\leads-command-center`

## Context Files to Read First
1. `docs/active_context.md` - current state overview
2. `src/lib/docker.ts` - understands how containers are spawned and where JSON results are stored.
3. `src/app/api/jobs/[id]/sync/route.ts` - the post-processing logic that moves JSON data to Supabase.

## What Was Done This Session
- **Cleaned Workspace**:
  - Stopped/Removed all `lcc-job-*` and `google-maps-scraper` containers.
  - Deleted all local temporary job files in `$env:TEMP\lcc-jobs`.
  - Preserved Qdrant containers as requested.
- **Root Cause Analysis**:
  - Confirmed the `results` table in Supabase is empty.
  - Identified that `/api/leads` 500 error was due to querying an empty table without auth (RLS blocking).
  - Found a scraper validation error: Job `eb88c547` failed because "Fast Mode" was used without geo coordinates.

## Current State
- The system is in a "Clean Slate" mode.
- Local temporary directories are empty.
- Docker environment is clear of scraper instances.
- **The user is about to TRUNCATE the `jobs` and `results` tables in Supabase.**

## What's Left to Do (Next Steps)
- [ ] **Verify Truncate**: Ensure Supabase tables are ready.
- [ ] **Start Fresh Job**: Open the UI and submit a new job (avoid "Fast Mode" for now unless coordinates are provided).
- [ ] **Monitor Flow**:
  1. Job creation (spawns container).
  2. Scraper completion (exited code 0).
  3. POST `/api/jobs/[id]/sync` to insert leads.
- [ ] **Verify Leads API**: check `/leads` page to ensure data appears.

## Gotchas / Watch Out For
- **JSONB vs RLS**: If querying via terminal/postman, remember that RLS will block results unless you are authenticated as the user who owns the leads.
- **Cleanup**: The code currently calls `cleanupJobFiles(jobId)` after a successful sync. If you want to inspect `results.json` manually, you may want to temporarily comment out line 114 in `src/app/api/jobs/[id]/sync/route.ts`.

## How to Verify Current State
```bash
docker ps -a  # Should only show qdrant (or nothing)
ls $env:TEMP\lcc-jobs # Should show nothing
```

## Suggested First Action
Submit a new job for "Pizza in Milan" (or any other keyword) via the UI and check the terminal logs for the Docker container ID.
