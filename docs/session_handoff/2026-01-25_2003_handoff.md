# Restoration Blueprint & Session Handoff

> **IMPORTANT**: The code for this session was reverted. Use this document to re-implement the successful features.

## ðŸ”§ Critical Fix: Blank Map / Tiles
The "Blank Map" issue was caused by the default OpenStreetMap tile server not rendering correctly.

**The Solution:**
Switch to **CartoDB Dark Matter** tiles in `src/components/ui/map-base.tsx`.

**Code Snippet:**
```javascript
sources: {
    'cartodb-dark': {
        type: 'raster',
        tiles: [
            'https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png',
            'https://b.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png',
            'https://c.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png'
        ],
        tileSize: 256,
        attribution: '&copy; OpenStreetMap Contributors, &copy; CARTO',
        maxzoom: 20
    }
},
layers: [
    {
        id: 'cartodb-dark',
        type: 'raster',
        source: 'cartodb-dark',
        paint: { 'raster-opacity': 1 }
    }
]
```

---

## âœ… Features Ready for Re-introduction

### 1. Interactive Map View
- **Feature**: Clicking a marker opens a side panel on top of the map.
- **Key Files**: `src/app/map/page.tsx`, `src/components/ui/map-base.tsx`.
- **Implementation**: Maintain `selectedLead` state in `page.tsx`.

### 2. Map Side Panel Coordinates
- **Feature**: Display precise Lat/Lng in the details panel.
- **Code**: `selectedLead.latitude.toFixed(6), (selectedLead.longtitude || selectedLead.longitude).toFixed(6)`

### 3. Leads Table "Query" Column
- **Feature**: Show search term in table.
- **Implementation**: Add `input_id` column to `src/components/leads/leads-table.tsx`.

### 4. Map Coordinate Picker (New Job)
- **Feature**: Visual picker with Nominatim search.
- **Key File**: `src/components/ui/map-picker.tsx`.

---

## Next Session Instructions
1. Restore **Map Tiles** (CartoDB snippet).
2. Restore **Leads Query Column** (`input_id`).
3. Restore **Map Side Panel** & **Coordinates**.
4. Restore **Map Picker** in Job Form.
