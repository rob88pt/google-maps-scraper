# Session Handoff: Negative Filters & High-Res Previews

Read this file to continue where the previous session left off.

## Project Location
`d:\Websites\GMaps_scraper_gosom`

## Context Files to Read First
1. `docs/active_context.md` - current state and recent implementation.
2. `docs/task_list.md` - persistent backlog and completed items.
3. `docs/research_google_image_urls.md` - details on Google image parameters findings.

## What Was Done This Session
- **Implemented Negative Filters**:
    - Users can now filter for leads that "Do not have email" or "Do not have website".
    - Added mutual exclusivity in UI (selecting "Has email" unchecks "No email").
- **Implemented High-Resolution Image Previews**:
    - Discovered that appending `=s0` to Google Maps image URLs retrieves full-resolution versions.
    - Updated `LeadDetailPanel` to use these URLs in all Enlarged Dialog views.
- **Enhanced Preview Navigation**:
    - Added rectangular navigation arrows and keyboard support (**ArrowLeft** / **ArrowRight**) for cycling through images in preview mode.
    - Synchronized navigation between the side panel gallery and the full-screen dialog.
- **Process Improvements**:
    - Upgraded `copy_artifacts.ps1` with **Smart Deduplication** to prevent clutter in session archives.
    - Cleaned up the current session archive to only keep relevant files.

## What's Left to Do
- [ ] **System Stability**: Run end-to-end tests for larger datasets with negative filters applied.
- [ ] **Performance**: Monitor image loading times for `=s0` high-res images on slower connections.
- [ ] **Backlog**: Filter out "Report this photo" links in the scraper (still on backlog).

## Key Decisions Made
- Used **=s0** for images: Tests showed it consistently returns the highest resolution compared to specific sizes or default parameters.
- **Rectangular Buttons**: Preview buttons use a rectangular style to match the existing design tokens.
- **Deduplication**: Implemented hash-based check in the export script to keep archives clean.

## How to Verify Current State
1. Open the Leads app (`http://localhost:3000/leads`).
2. Apply "No email" filter and verify results.
3. Click a lead with multiple images, open preview, and navigate using on-screen arrows or keyboard.

## Last Artifacts Export
`d:\Websites\GMaps_scraper_gosom\docs\previous_chat_exports_archive\2026-01-25_0311_negative_filters_implementation\`
